{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/lib/license-db.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DB_PATH = path.join(process.cwd(), 'nexus-licenses.json');\r\n\r\nexport interface License {\r\n    key: string;\r\n    expires_at: string;\r\n    active: boolean;\r\n    reason?: string;\r\n    note?: string;\r\n    last_seen?: string;\r\n}\r\n\r\nexport const getLicenses = (): License[] => {\r\n    if (!fs.existsSync(DB_PATH)) {\r\n        return [];\r\n    }\r\n    try {\r\n        const data = fs.readFileSync(DB_PATH, 'utf-8');\r\n        return JSON.parse(data);\r\n    } catch (e) {\r\n        console.error('Error reading license DB:', e);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const saveLicenses = (licenses: License[]) => {\r\n    try {\r\n        const dir = path.dirname(DB_PATH);\r\n        if (!fs.existsSync(dir)) {\r\n            fs.mkdirSync(dir, { recursive: true });\r\n        }\r\n        fs.writeFileSync(DB_PATH, JSON.stringify(licenses, null, 2));\r\n    } catch (e) {\r\n        console.error('Error saving license DB:', e);\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAWlC,MAAM,cAAc;IACvB,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,UAAU;QACzB,OAAO,EAAE;IACb;IACA,IAAI;QACA,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,SAAS;QACtC,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,EAAE;IACb;AACJ;AAEO,MAAM,eAAe,CAAC;IACzB,IAAI;QACA,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC;QACzB,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,MAAM;YACrB,wGAAE,CAAC,SAAS,CAAC,KAAK;gBAAE,WAAW;YAAK;QACxC;QACA,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,UAAU,MAAM;IAC7D,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,4BAA4B;IAC9C;AACJ"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/app/api/license/admin/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { getLicenses, saveLicenses, License } from '@/lib/license-db';\r\n\r\n// SECRET_ADMIN_TOKEN is used to protect this API. \r\n// On Fly.io, set this as an environment variable (fly secrets set ADMIN_TOKEN=your_pass)\r\nconst ADMIN_TOKEN = process.env.ADMIN_TOKEN || 'nexus-master-key';\r\n\r\nexport async function GET(req: NextRequest) {\r\n    const token = req.nextUrl.searchParams.get('token');\r\n    if (token !== ADMIN_TOKEN) return NextResponse.json({ error: 'No autorizado' }, { status: 401 });\r\n\r\n    return NextResponse.json(getLicenses());\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n    const token = req.nextUrl.searchParams.get('token');\r\n    if (token !== ADMIN_TOKEN) return NextResponse.json({ error: 'No autorizado' }, { status: 401 });\r\n\r\n    try {\r\n        const { action, licenseData } = await req.json();\r\n        let licenses = getLicenses();\r\n\r\n        if (action === 'add') {\r\n            licenses.push(licenseData);\r\n        } else if (action === 'update') {\r\n            licenses = licenses.map(l => l.key === licenseData.key ? { ...l, ...licenseData } : l);\r\n        } else if (action === 'delete') {\r\n            licenses = licenses.filter(l => l.key !== licenseData.key);\r\n        }\r\n\r\n        saveLicenses(licenses);\r\n        return NextResponse.json({ success: true, licenses });\r\n    } catch (e) {\r\n        return NextResponse.json({ error: 'Error procesando solicitud' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,mDAAmD;AACnD,yFAAyF;AACzF,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAExC,eAAe,IAAI,GAAgB;IACtC,MAAM,QAAQ,IAAI,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAC3C,IAAI,UAAU,aAAa,OAAO,sKAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAgB,GAAG;QAAE,QAAQ;IAAI;IAE9F,OAAO,sKAAY,CAAC,IAAI,CAAC,IAAA,2JAAW;AACxC;AAEO,eAAe,KAAK,GAAgB;IACvC,MAAM,QAAQ,IAAI,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAC3C,IAAI,UAAU,aAAa,OAAO,sKAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAgB,GAAG;QAAE,QAAQ;IAAI;IAE9F,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG,MAAM,IAAI,IAAI;QAC9C,IAAI,WAAW,IAAA,2JAAW;QAE1B,IAAI,WAAW,OAAO;YAClB,SAAS,IAAI,CAAC;QAClB,OAAO,IAAI,WAAW,UAAU;YAC5B,WAAW,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,GAAG,KAAK,YAAY,GAAG,GAAG;oBAAE,GAAG,CAAC;oBAAE,GAAG,WAAW;gBAAC,IAAI;QACxF,OAAO,IAAI,WAAW,UAAU;YAC5B,WAAW,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,GAAG,KAAK,YAAY,GAAG;QAC7D;QAEA,IAAA,4JAAY,EAAC;QACb,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAS;IACvD,EAAE,OAAO,GAAG;QACR,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACJ"}}]
}