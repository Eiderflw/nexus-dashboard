{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/lib/license-db.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_DIR = process.env.DATA_DIR || process.cwd();\r\nconst DB_PATH = path.join(DATA_DIR, 'nexus-licenses.json');\r\n\r\nexport interface License {\r\n    key: string;\r\n    expires_at: string;\r\n    active: boolean;\r\n    reason?: string;\r\n    note?: string;\r\n    last_seen?: string;\r\n}\r\n\r\nexport const getLicenses = (): License[] => {\r\n    if (!fs.existsSync(DB_PATH)) {\r\n        return [];\r\n    }\r\n    try {\r\n        const data = fs.readFileSync(DB_PATH, 'utf-8');\r\n        return JSON.parse(data);\r\n    } catch (e) {\r\n        console.error('Error reading license DB:', e);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const saveLicenses = (licenses: License[]) => {\r\n    try {\r\n        const dir = path.dirname(DB_PATH);\r\n        if (!fs.existsSync(dir)) {\r\n            fs.mkdirSync(dir, { recursive: true });\r\n        }\r\n        fs.writeFileSync(DB_PATH, JSON.stringify(licenses, null, 2));\r\n    } catch (e) {\r\n        console.error('Error saving license DB:', e);\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,WAAW,QAAQ,GAAG,CAAC,QAAQ,IAAI,QAAQ,GAAG;AACpD,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,UAAU;AAW7B,MAAM,cAAc;IACvB,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,UAAU;QACzB,OAAO,EAAE;IACb;IACA,IAAI;QACA,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,SAAS;QACtC,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,EAAE;IACb;AACJ;AAEO,MAAM,eAAe,CAAC;IACzB,IAAI;QACA,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC;QACzB,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,MAAM;YACrB,wGAAE,CAAC,SAAS,CAAC,KAAK;gBAAE,WAAW;YAAK;QACxC;QACA,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,UAAU,MAAM;IAC7D,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,4BAA4B;IAC9C;AACJ"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/app/api/license/validate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { getLicenses, saveLicenses } from '@/lib/license-db';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { key } = await req.json();\r\n\r\n        if (!key) {\r\n            return NextResponse.json({ valid: false, message: 'Llave requerida' }, { status: 400 });\r\n        }\r\n\r\n        const licenses = getLicenses();\r\n        const searchKey = key.trim().toUpperCase();\r\n        const license = licenses.find(l => l.key.trim().toUpperCase() === searchKey);\r\n\r\n        if (!license) {\r\n            return NextResponse.json({ valid: false, message: 'La licencia no existe o es inválida.' });\r\n        }\r\n\r\n        if (!license.active) {\r\n            return NextResponse.json({\r\n                valid: false,\r\n                message: license.reason || 'Esta licencia ha sido desactivada por el administrador.'\r\n            });\r\n        }\r\n\r\n        const expiryDate = new Date(license.expires_at);\r\n        const now = new Date();\r\n\r\n        if (now > expiryDate) {\r\n            return NextResponse.json({\r\n                valid: false,\r\n                message: `Tu licencia expiró el ${license.expires_at}. Contacta a soporte.`\r\n            });\r\n        }\r\n\r\n        // Update last_seen\r\n        const updatedLicenses = licenses.map(l =>\r\n            l.key.trim().toUpperCase() === searchKey\r\n                ? { ...l, last_seen: new Date().toISOString() }\r\n                : l\r\n        );\r\n        saveLicenses(updatedLicenses);\r\n\r\n        return NextResponse.json({\r\n            valid: true,\r\n            expires_at: license.expires_at,\r\n            server_time: new Date().toISOString(),\r\n            message: 'Licencia activa'\r\n        });\r\n\r\n    } catch (error) {\r\n        return NextResponse.json({ valid: false, message: 'Error interno de validación' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,IAAI;QAE9B,IAAI,CAAC,KAAK;YACN,OAAO,sKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAO,SAAS;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,MAAM,WAAW,IAAA,2JAAW;QAC5B,MAAM,YAAY,IAAI,IAAI,GAAG,WAAW;QACxC,MAAM,UAAU,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,GAAG,CAAC,IAAI,GAAG,WAAW,OAAO;QAElE,IAAI,CAAC,SAAS;YACV,OAAO,sKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAO,SAAS;YAAuC;QAC7F;QAEA,IAAI,CAAC,QAAQ,MAAM,EAAE;YACjB,OAAO,sKAAY,CAAC,IAAI,CAAC;gBACrB,OAAO;gBACP,SAAS,QAAQ,MAAM,IAAI;YAC/B;QACJ;QAEA,MAAM,aAAa,IAAI,KAAK,QAAQ,UAAU;QAC9C,MAAM,MAAM,IAAI;QAEhB,IAAI,MAAM,YAAY;YAClB,OAAO,sKAAY,CAAC,IAAI,CAAC;gBACrB,OAAO;gBACP,SAAS,CAAC,sBAAsB,EAAE,QAAQ,UAAU,CAAC,qBAAqB,CAAC;YAC/E;QACJ;QAEA,mBAAmB;QACnB,MAAM,kBAAkB,SAAS,GAAG,CAAC,CAAA,IACjC,EAAE,GAAG,CAAC,IAAI,GAAG,WAAW,OAAO,YACzB;gBAAE,GAAG,CAAC;gBAAE,WAAW,IAAI,OAAO,WAAW;YAAG,IAC5C;QAEV,IAAA,4JAAY,EAAC;QAEb,OAAO,sKAAY,CAAC,IAAI,CAAC;YACrB,OAAO;YACP,YAAY,QAAQ,UAAU;YAC9B,aAAa,IAAI,OAAO,WAAW;YACnC,SAAS;QACb;IAEJ,EAAE,OAAO,OAAO;QACZ,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAO,SAAS;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACrG;AACJ"}}]
}