{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/app/api/scraper/check-agency/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { spawn } from 'child_process';\r\nimport path from 'path';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { creators, cookie } = await req.json();\r\n\r\n        if (!creators || !Array.isArray(creators) || creators.length === 0) {\r\n            return NextResponse.json({ error: 'Lista de creadores inválida' }, { status: 400 });\r\n        }\r\n\r\n        const scriptPath = path.join(process.cwd(), 'scripts', 'check-agency.js');\r\n        const creatorsArg = creators.join(',');\r\n        const cookieArg = cookie || 'none';\r\n\r\n        return new Promise((resolve) => {\r\n            const child = spawn('node', [scriptPath, creatorsArg, cookieArg]);\r\n\r\n            let stdout = '';\r\n            let stderr = '';\r\n\r\n            child.stdout.on('data', (data) => {\r\n                stdout += data.toString();\r\n            });\r\n\r\n            child.stderr.on('data', (data) => {\r\n                stderr += data.toString();\r\n            });\r\n\r\n            child.on('close', (code) => {\r\n                if (code !== 0) {\r\n                    console.error('Script Error:', stderr);\r\n                    resolve(NextResponse.json({ error: 'Error ejecutando el script de validación', details: stderr }, { status: 500 }));\r\n                } else {\r\n                    try {\r\n                        const result = JSON.parse(stdout);\r\n                        if (result.error) {\r\n                            resolve(NextResponse.json({ error: result.error }, { status: 500 }));\r\n                        } else {\r\n                            resolve(NextResponse.json(result));\r\n                        }\r\n                    } catch (e) {\r\n                        console.error('Parse Error:', e, stdout);\r\n                        resolve(NextResponse.json({ error: 'Error analizando respuesta del script', details: stdout }, { status: 500 }));\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Proxy Error:', error);\r\n        return NextResponse.json({ error: 'Error interno del servidor', details: error.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAE3C,IAAI,CAAC,YAAY,CAAC,MAAM,OAAO,CAAC,aAAa,SAAS,MAAM,KAAK,GAAG;YAChE,OAAO,sKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,WAAW;QACvD,MAAM,cAAc,SAAS,IAAI,CAAC;QAClC,MAAM,YAAY,UAAU;QAE5B,OAAO,IAAI,QAAQ,CAAC;YAChB,MAAM,QAAQ,IAAA,4HAAK,EAAC,QAAQ;gBAAC;gBAAY;gBAAa;aAAU;YAEhE,IAAI,SAAS;YACb,IAAI,SAAS;YAEb,MAAM,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC;gBACrB,UAAU,KAAK,QAAQ;YAC3B;YAEA,MAAM,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC;gBACrB,UAAU,KAAK,QAAQ;YAC3B;YAEA,MAAM,EAAE,CAAC,SAAS,CAAC;gBACf,IAAI,SAAS,GAAG;oBACZ,QAAQ,KAAK,CAAC,iBAAiB;oBAC/B,QAAQ,sKAAY,CAAC,IAAI,CAAC;wBAAE,OAAO;wBAA4C,SAAS;oBAAO,GAAG;wBAAE,QAAQ;oBAAI;gBACpH,OAAO;oBACH,IAAI;wBACA,MAAM,SAAS,KAAK,KAAK,CAAC;wBAC1B,IAAI,OAAO,KAAK,EAAE;4BACd,QAAQ,sKAAY,CAAC,IAAI,CAAC;gCAAE,OAAO,OAAO,KAAK;4BAAC,GAAG;gCAAE,QAAQ;4BAAI;wBACrE,OAAO;4BACH,QAAQ,sKAAY,CAAC,IAAI,CAAC;wBAC9B;oBACJ,EAAE,OAAO,GAAG;wBACR,QAAQ,KAAK,CAAC,gBAAgB,GAAG;wBACjC,QAAQ,sKAAY,CAAC,IAAI,CAAC;4BAAE,OAAO;4BAAyC,SAAS;wBAAO,GAAG;4BAAE,QAAQ;wBAAI;oBACjH;gBACJ;YACJ;QACJ;IAEJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA8B,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC5G;AACJ"}}]
}