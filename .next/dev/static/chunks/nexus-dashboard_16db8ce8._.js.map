{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/lib/excel-parser.ts"],"sourcesContent":["import * as XLSX from 'xlsx';\r\nimport { Creator } from '@/types';\r\n\r\nexport const parseExcel = (file: File, onProgress?: (progress: number) => void): Promise<Creator[]> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onprogress = (e) => {\r\n            if (e.lengthComputable && onProgress) {\r\n                const percent = Math.round((e.loaded / e.total) * 50); // Reading is 50% of the work\r\n                onProgress(percent);\r\n            }\r\n        };\r\n\r\n        reader.onload = (e) => {\r\n            try {\r\n                if (onProgress) onProgress(60); // File read complete\r\n\r\n                const data = e.target?.result;\r\n                const workbook = XLSX.read(data, { type: 'binary' });\r\n\r\n                if (onProgress) onProgress(80); // Workbook parsed\r\n\r\n                const sheetName = workbook.SheetNames[0];\r\n                const sheet = workbook.Sheets[sheetName];\r\n                const jsonData = XLSX.utils.sheet_to_json(sheet);\r\n\r\n                if (jsonData.length === 0) {\r\n                    throw new Error(\"El archivo Excel estÃ¡ vacÃ­o o no se pudieron leer las filas.\");\r\n                }\r\n\r\n                // Validation: Check for critical columns in the first row\r\n                const firstRow: any = jsonData[0];\r\n                const requiredColumns = [\r\n                    'ID del creador',\r\n                    'Nombre de usuario del creador',\r\n                    'Diamantes',\r\n                    'DuraciÃ³n de LIVE'\r\n                ];\r\n\r\n                const missingColumns = requiredColumns.filter(col => !(col in firstRow));\r\n\r\n                if (missingColumns.length > 0) {\r\n                    throw new Error(`Faltan columnas obligatorias: ${missingColumns.join(', ')}. Por favor verifica el formato del archivo.`);\r\n                }\r\n\r\n                const creators: Creator[] = jsonData.map((row: any) => ({\r\n                    period: row['Periodo de datos'] || '',\r\n                    creatorId: String(row['ID del creador'] || ''),\r\n                    username: row['Nombre de usuario del creador'] || 'Unknown',\r\n                    group: row['Grupo'] || '',\r\n                    agent: row['Agente'] || '',\r\n                    joinTime: row['Hora de incorporaciÃ³n'] || '',\r\n                    daysSinceJoin: Number(row['DÃ­as desde la incorporaciÃ³n']) || 0,\r\n\r\n                    diamonds: Number(row['Diamantes']) || 0,\r\n                    liveHours: parseDuration(row['DuraciÃ³n de LIVE']),\r\n                    validDays: Number(row['DÃ­as vÃ¡lidos de emisiones LIVE']) || 0,\r\n                    newFollowers: Number(row['Nuevos seguidores']) || 0,\r\n                    liveSessions: Number(row['Emisiones LIVE']) || 0,\r\n\r\n                    lastMonthDiamonds: Number(row['Diamantes en el Ãºltimo mes']) || 0,\r\n                    lastMonthLiveHours: Number(row['DuraciÃ³n de emisiones LIVE (en horas) durante el Ãºltimo mes']) || 0,\r\n                    lastMonthValidDays: Number(row['DÃ­as vÃ¡lidos de emisiones LIVE del mes pasado']) || 0,\r\n                    lastMonthNewFollowers: Number(row['Nuevos seguidores en el Ãºltimo mes']) || 0,\r\n                    lastMonthLiveSessions: Number(row['Emisiones LIVE en el Ãºltimo mes']) || 0,\r\n\r\n                    diamondsAchieved: parsePercentage(row['Diamantes - Porcentaje logrado']),\r\n                    liveHoursAchieved: parsePercentage(row['DuraciÃ³n de LIVE - Porcentaje logrado']),\r\n                    validDaysAchieved: parsePercentage(row['DÃ­as vÃ¡lidos de emisiones LIVE - Porcentaje logrado']),\r\n                    newFollowersAchieved: parsePercentage(row['Nuevos seguidores - Porcentaje logrado']),\r\n                    liveSessionsAchieved: parsePercentage(row['Emisiones LIVE - Porcentaje logrado']),\r\n\r\n                    diamondsGrowth: parsePercentage(row['Diamantes - frente al mes pasado']),\r\n                    liveHoursGrowth: parsePercentage(row['DuraciÃ³n de LIVE - frente al mes pasado']),\r\n                    validDaysGrowth: parsePercentage(row['DÃ­as vÃ¡lidos de emisiones LIVE - frente al mes pasado']),\r\n                    newFollowersGrowth: parsePercentage(row['Nuevos seguidores - frente al mes pasado']),\r\n                    liveSessionsGrowth: parsePercentage(row['Emisiones LIVE - frente al mes pasado']),\r\n\r\n                    battles: Number(row['Partidas']) || 0,\r\n                    battleDiamonds: Number(row['Diamantes de partidas']) || 0,\r\n                    newLiveCreators: Number(row['Nuevos creadores LIVE']) || 0,\r\n                    multiGuestDiamonds: Number(row['Diamantes del modo de varios invitados']) || 0,\r\n                    multiGuestHostDiamonds: Number(row['Diamantes de varios invitados (como anfitriÃ³n)']) || 0,\r\n                    multiGuestGuestDiamonds: Number(row['Diamantes del modo de varios invitados (como invitado)']) || 0,\r\n\r\n                    baseDiamondsBeforeJoin: Number(row['Base de Diamantes antes de unirse']) || 0,\r\n                    graduationStatus: row['Estado de graduaciÃ³n'] || '',\r\n                }));\r\n\r\n                if (onProgress) onProgress(100); // Done\r\n                resolve(creators);\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        };\r\n\r\n        reader.onerror = (error) => reject(new Error(\"Error al leer el archivo.\"));\r\n        reader.readAsBinaryString(file);\r\n    });\r\n};\r\n\r\nconst parseDuration = (value: any): number => {\r\n    if (typeof value === 'number') return value * 24; // Excel stores time as fraction of day usually, but here it might be explicit. \r\n    // If it's just a number like 26.5, return it. If it's < 1 and > 0, likely a day fraction? \r\n    // Let's assume if it's a number it's hours if > 1, or check context. \r\n    // Actually, looking at screenshot, it's a string. If Excel parses it as number, it's usually days.\r\n    // Safest is to handle string.\r\n\r\n    if (typeof value === 'string') {\r\n        value = value.trim();\r\n        let hours = 0;\r\n        let minutes = 0;\r\n        let seconds = 0;\r\n\r\n        const hMatch = value.match(/(\\d+)\\s*h/);\r\n        const mMatch = value.match(/(\\d+)\\s*min/);\r\n        const sMatch = value.match(/(\\d+)\\s*s/);\r\n\r\n        if (hMatch) hours = parseInt(hMatch[1], 10);\r\n        if (mMatch) minutes = parseInt(mMatch[1], 10);\r\n        if (sMatch) seconds = parseInt(sMatch[1], 10);\r\n\r\n        return hours + (minutes / 60) + (seconds / 3600);\r\n    }\r\n    return 0;\r\n};\r\n\r\nconst parsePercentage = (value: any): number => {\r\n    if (typeof value === 'number') return value;\r\n    if (typeof value === 'string') {\r\n        return parseFloat(value.replace('%', '')) / 100;\r\n    }\r\n    return 0;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,+LAAO,EAAC,IAAA,sKAAI,EAAC;AACxB"}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/lib/analysis.ts"],"sourcesContent":["import { Creator } from '@/types';\r\n\r\nexport const getTopCreators = (creators: Creator[], limit: number = 10): Creator[] => {\r\n    return [...creators].sort((a, b) => b.diamonds - a.diamonds).slice(0, limit);\r\n};\r\n\r\nexport const getRisingStars = (creators: Creator[]): Creator[] => {\r\n    // New creators (< 30 days) with high diamonds (> 1000 or top 20% percentile logic if we had it)\r\n    // For MVP: < 45 days tenure and > 500 diamonds\r\n    return creators.filter(c => c.daysSinceJoin <= 45 && c.diamonds > 500)\r\n        .sort((a, b) => b.diamondsGrowth - a.diamondsGrowth);\r\n};\r\n\r\nexport const getAtRiskCreators = (creators: Creator[]): Creator[] => {\r\n    const today = new Date();\r\n    const currentDay = today.getDate();\r\n    const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();\r\n    const expectedProgress = currentDay / daysInMonth; // e.g. 13/30 = 0.43 (43%)\r\n\r\n    // Logic: At Risk if 'Month Progress' (diamondsAchieved) is significantly behind 'Expected Progress'\r\n    // OR if 'Daily Trend' (diamondsGrowth) is severely negative (-50%+) indicating a crash today.\r\n    return creators.filter(c => {\r\n        const isVeteran = c.daysSinceJoin > 30; // Only check people who have been here a while\r\n\r\n        // Lagging Month Progress: They have achieved less than 80% of what they should have by now\r\n        // e.g. Expected 43%, they have < 34%\r\n        const isLagging = c.diamondsAchieved < (expectedProgress * 0.8);\r\n\r\n        // Crashing Daily: Today they did much worse than same day last month\r\n        const isCrashingDaily = c.diamondsGrowth < -0.5;\r\n\r\n        return isVeteran && (isLagging || isCrashingDaily);\r\n    }).sort((a, b) => a.diamondsAchieved - b.diamondsAchieved); // Sort by lowest progress first\r\n};\r\n\r\nexport const getBattleSpecialists = (creators: Creator[]): Creator[] => {\r\n    // High ratio of Battle diamonds to Total diamonds\r\n    return creators.filter(c => {\r\n        const ratio = c.battleDiamonds / (c.diamonds || 1);\r\n        return c.diamonds > 1000 && ratio > 0.4; // > 40% income from battles\r\n    }).sort((a, b) => b.battleDiamonds - a.battleDiamonds);\r\n};\r\n\r\nexport const generateAiAdvice = (creator: Creator): string => {\r\n    const today = new Date();\r\n    const currentDay = today.getDate();\r\n    const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();\r\n    const expectedProgressPercent = Math.round((currentDay / daysInMonth) * 100);\r\n    const achievedPercent = Math.round((creator.diamondsAchieved || 0) * 100);\r\n    const dailyTrendPercent = Math.round((creator.diamondsDailyTrend || 0) * 100);\r\n\r\n    // 1. Critical Decline (Decay Recovery Message - User Request)\r\n    // If lagging behind monthly schedule\r\n    if (achievedPercent < expectedProgressPercent * 0.9) {\r\n        return `Hola ${creator.username}! ðŸ“‰ AnÃ¡lisis de tu Agencia: Hoy es dÃ­a ${currentDay} y llevas un PROGRESO DEL ${achievedPercent}% de tu meta mensual. DeberÃ­as ir por el ${expectedProgressPercent}% para superar tu mes anterior. ðŸ’¡ TU TENDENCIA HOY: ${dailyTrendPercent > 0 ? '+' : ''}${dailyTrendPercent}% vs este dÃ­a el mes pasado. Â¡Aura! Necesitas apretar el paso: transmite horas extras y activa batallas PK YA. ðŸš€`;\r\n    }\r\n\r\n    // 2. Low Consistency (Yellow Flag)\r\n    if (creator.validDays < 5 && creator.daysSinceJoin > 10) {\r\n        return \"âš ï¸ CONSISTENCIA BAJA: No estÃ¡ cumpliendo los dÃ­as mÃ­nimos. Sugerencia: Establecer un horario fijo y publicarlo en sus estados.\";\r\n    }\r\n\r\n    // 3. High Potential (Green Flag)\r\n    if (creator.newFollowers > 50 && creator.diamondsGrowth > 0.1) {\r\n        return \"ðŸš€ TENDENCIA VIRAL: EstÃ¡ ganando seguidores rÃ¡pido. Sugerencia: Pedir a los nuevos fans que se unan al grupo de fans o Discord.\";\r\n    }\r\n\r\n    // 4. Whale Hunter (Blue Flag)\r\n    if (creator.diamonds > 10000 && creator.liveHours < 10) {\r\n        return \"ðŸ’Ž EFICIENCIA ALTA: Gana mucho en poco tiempo. Sugerencia: Si transmite 1 hora mÃ¡s, podrÃ­a duplicar sus ingresos.\";\r\n    }\r\n\r\n    // 5. Stable (Grey Flag)\r\n    return \"âœ… DESEMPEÃ‘O ESTABLE: Mantener el ritmo actual. Sugerencia: Probar nuevas dinÃ¡micas para romper la rutina.\";\r\n};\r\n\r\nexport const getConsistencyScore = (creator: Creator): number => {\r\n    // Simple consistency score 0-100 based on valid days vs total days available (capped at 15 for calculation)\r\n    const targetDays = Math.min(creator.daysSinceJoin, 15);\r\n    if (targetDays === 0) return 100;\r\n    return Math.round((creator.validDays / targetDays) * 100);\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAEO,MAAM,iBAAiB,CAAC,UAAqB,QAAgB,EAAE;IAClE,OAAO;WAAI;KAAS,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,QAAQ,GAAG,EAAE,QAAQ,EAAE,KAAK,CAAC,GAAG;AAC1E;AAEO,MAAM,iBAAiB,CAAC;IAC3B,gGAAgG;IAChG,+CAA+C;IAC/C,OAAO,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,aAAa,IAAI,MAAM,EAAE,QAAQ,GAAG,KAC7D,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,cAAc,GAAG,EAAE,cAAc;AAC3D;AAEO,MAAM,oBAAoB,CAAC;IAC9B,MAAM,QAAQ,IAAI;IAClB,MAAM,aAAa,MAAM,OAAO;IAChC,MAAM,cAAc,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,KAAK,GAAG,GAAG,OAAO;IAClF,MAAM,mBAAmB,aAAa,aAAa,0BAA0B;IAE7E,oGAAoG;IACpG,8FAA8F;IAC9F,OAAO,SAAS,MAAM,CAAC,CAAA;QACnB,MAAM,YAAY,EAAE,aAAa,GAAG,IAAI,+CAA+C;QAEvF,2FAA2F;QAC3F,qCAAqC;QACrC,MAAM,YAAY,EAAE,gBAAgB,GAAI,mBAAmB;QAE3D,qEAAqE;QACrE,MAAM,kBAAkB,EAAE,cAAc,GAAG,CAAC;QAE5C,OAAO,aAAa,CAAC,aAAa,eAAe;IACrD,GAAG,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,gBAAgB,GAAG,EAAE,gBAAgB,GAAG,gCAAgC;AAChG;AAEO,MAAM,uBAAuB,CAAC;IACjC,kDAAkD;IAClD,OAAO,SAAS,MAAM,CAAC,CAAA;QACnB,MAAM,QAAQ,EAAE,cAAc,GAAG,CAAC,EAAE,QAAQ,IAAI,CAAC;QACjD,OAAO,EAAE,QAAQ,GAAG,QAAQ,QAAQ,KAAK,4BAA4B;IACzE,GAAG,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,cAAc,GAAG,EAAE,cAAc;AACzD;AAEO,MAAM,mBAAmB,CAAC;IAC7B,MAAM,QAAQ,IAAI;IAClB,MAAM,aAAa,MAAM,OAAO;IAChC,MAAM,cAAc,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,KAAK,GAAG,GAAG,OAAO;IAClF,MAAM,0BAA0B,KAAK,KAAK,CAAC,AAAC,aAAa,cAAe;IACxE,MAAM,kBAAkB,KAAK,KAAK,CAAC,CAAC,QAAQ,gBAAgB,IAAI,CAAC,IAAI;IACrE,MAAM,oBAAoB,KAAK,KAAK,CAAC,CAAC,QAAQ,kBAAkB,IAAI,CAAC,IAAI;IAEzE,8DAA8D;IAC9D,qCAAqC;IACrC,IAAI,kBAAkB,0BAA0B,KAAK;QACjD,OAAO,CAAC,KAAK,EAAE,QAAQ,QAAQ,CAAC,wCAAwC,EAAE,WAAW,0BAA0B,EAAE,gBAAgB,yCAAyC,EAAE,wBAAwB,qDAAqD,EAAE,oBAAoB,IAAI,MAAM,KAAK,kBAAkB,iHAAiH,CAAC;IACta;IAEA,mCAAmC;IACnC,IAAI,QAAQ,SAAS,GAAG,KAAK,QAAQ,aAAa,GAAG,IAAI;QACrD,OAAO;IACX;IAEA,iCAAiC;IACjC,IAAI,QAAQ,YAAY,GAAG,MAAM,QAAQ,cAAc,GAAG,KAAK;QAC3D,OAAO;IACX;IAEA,8BAA8B;IAC9B,IAAI,QAAQ,QAAQ,GAAG,SAAS,QAAQ,SAAS,GAAG,IAAI;QACpD,OAAO;IACX;IAEA,wBAAwB;IACxB,OAAO;AACX;AAEO,MAAM,sBAAsB,CAAC;IAChC,4GAA4G;IAC5G,MAAM,aAAa,KAAK,GAAG,CAAC,QAAQ,aAAa,EAAE;IACnD,IAAI,eAAe,GAAG,OAAO;IAC7B,OAAO,KAAK,KAAK,CAAC,AAAC,QAAQ,SAAS,GAAG,aAAc;AACzD"}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Eiderflw/Desktop/API%20DIAN/EXCEL/nexus-dashboard/store/useCreatorStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist, createJSONStorage } from 'zustand/middleware';\r\nimport { Creator } from '@/types';\r\n\r\ninterface CreatorStore {\r\n    creators: Creator[];\r\n    setCreators: (newCreators: Creator[]) => void;\r\n    updateCreator: (creatorId: string, updates: Partial<Creator>) => void;\r\n    lastUpdated: Date | null;\r\n    loadContacts: () => Promise<void>; // New action to load contacts\r\n}\r\n\r\nexport const useCreatorStore = create<CreatorStore>()(\r\n    persist(\r\n        (set, get) => ({\r\n            creators: [],\r\n            lastUpdated: null,\r\n            loadContacts: async () => {\r\n                try {\r\n                    const response = await fetch('/api/contacts');\r\n                    const contacts = await response.json();\r\n\r\n                    set((state) => ({\r\n                        creators: state.creators.map(c => ({\r\n                            ...c,\r\n                            whatsapp: contacts[c.creatorId] || c.whatsapp\r\n                        }))\r\n                    }));\r\n                } catch (e) {\r\n                    console.error(\"Failed to load contacts\", e);\r\n                }\r\n            },\r\n            setCreators: (newCreators) => {\r\n                const previousCreators = get().creators;\r\n\r\n                // Calculate comparison with previous data (yesterday) AND PERSERVE DATA (WhatsApp)\r\n                const enhancedCreators = newCreators.map(nc => {\r\n                    const prev = previousCreators.find(pc => pc.creatorId === nc.creatorId);\r\n                    if (prev) {\r\n                        return {\r\n                            ...nc,\r\n                            // Persist Contact Info (First from memory, verify with API later if needed)\r\n                            whatsapp: prev.whatsapp,\r\n                            phoneCode: prev.phoneCode,\r\n                            // Persist Avatar if missing in new data (unlikely if synced)\r\n                            avatar: nc.avatar || prev.avatar,\r\n                            // Calculate Deltas\r\n                            dailyDiamondsChange: nc.diamonds - prev.diamonds,\r\n                            dailyLiveHoursChange: nc.liveHours - prev.liveHours,\r\n                            dailyValidDaysChange: nc.validDays - prev.validDays\r\n                        };\r\n                    }\r\n                    return nc; // New creator or no history\r\n                });\r\n\r\n                set({ creators: enhancedCreators, lastUpdated: new Date() });\r\n                get().loadContacts(); // Refresh from DB just in case\r\n            },\r\n            updateCreator: async (creatorId, updates) => {\r\n                // Optimistic Update\r\n                set((state) => ({\r\n                    creators: state.creators.map((c) =>\r\n                        c.creatorId === creatorId ? { ...c, ...updates } : c\r\n                    ),\r\n                }));\r\n\r\n                // Persist to File if whatsapp changed\r\n                if (updates.whatsapp) {\r\n                    try {\r\n                        await fetch('/api/contacts', {\r\n                            method: 'POST',\r\n                            headers: { 'Content-Type': 'application/json' },\r\n                            body: JSON.stringify({ creatorId, whatsapp: updates.whatsapp })\r\n                        });\r\n                    } catch (e) {\r\n                        console.error(\"Failed to save contact to file\", e);\r\n                    }\r\n                }\r\n            },\r\n        }),\r\n        {\r\n            name: 'nexus-storage', // unique name\r\n            storage: createJSONStorage(() => localStorage),\r\n        }\r\n    )\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAWO,MAAM,kBAAkB,IAAA,2KAAM,IACjC,IAAA,iLAAO,EACH,CAAC,KAAK,MAAQ,CAAC;QACX,UAAU,EAAE;QACZ,aAAa;QACb,cAAc;YACV,IAAI;gBACA,MAAM,WAAW,MAAM,MAAM;gBAC7B,MAAM,WAAW,MAAM,SAAS,IAAI;gBAEpC,IAAI,CAAC,QAAU,CAAC;wBACZ,UAAU,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAA,IAAK,CAAC;gCAC/B,GAAG,CAAC;gCACJ,UAAU,QAAQ,CAAC,EAAE,SAAS,CAAC,IAAI,EAAE,QAAQ;4BACjD,CAAC;oBACL,CAAC;YACL,EAAE,OAAO,GAAG;gBACR,QAAQ,KAAK,CAAC,2BAA2B;YAC7C;QACJ;QACA,aAAa,CAAC;YACV,MAAM,mBAAmB,MAAM,QAAQ;YAEvC,mFAAmF;YACnF,MAAM,mBAAmB,YAAY,GAAG,CAAC,CAAA;gBACrC,MAAM,OAAO,iBAAiB,IAAI,CAAC,CAAA,KAAM,GAAG,SAAS,KAAK,GAAG,SAAS;gBACtE,IAAI,MAAM;oBACN,OAAO;wBACH,GAAG,EAAE;wBACL,4EAA4E;wBAC5E,UAAU,KAAK,QAAQ;wBACvB,WAAW,KAAK,SAAS;wBACzB,6DAA6D;wBAC7D,QAAQ,GAAG,MAAM,IAAI,KAAK,MAAM;wBAChC,mBAAmB;wBACnB,qBAAqB,GAAG,QAAQ,GAAG,KAAK,QAAQ;wBAChD,sBAAsB,GAAG,SAAS,GAAG,KAAK,SAAS;wBACnD,sBAAsB,GAAG,SAAS,GAAG,KAAK,SAAS;oBACvD;gBACJ;gBACA,OAAO,IAAI,4BAA4B;YAC3C;YAEA,IAAI;gBAAE,UAAU;gBAAkB,aAAa,IAAI;YAAO;YAC1D,MAAM,YAAY,IAAI,+BAA+B;QACzD;QACA,eAAe,OAAO,WAAW;YAC7B,oBAAoB;YACpB,IAAI,CAAC,QAAU,CAAC;oBACZ,UAAU,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAC,IAC1B,EAAE,SAAS,KAAK,YAAY;4BAAE,GAAG,CAAC;4BAAE,GAAG,OAAO;wBAAC,IAAI;gBAE3D,CAAC;YAED,sCAAsC;YACtC,IAAI,QAAQ,QAAQ,EAAE;gBAClB,IAAI;oBACA,MAAM,MAAM,iBAAiB;wBACzB,QAAQ;wBACR,SAAS;4BAAE,gBAAgB;wBAAmB;wBAC9C,MAAM,KAAK,SAAS,CAAC;4BAAE;4BAAW,UAAU,QAAQ,QAAQ;wBAAC;oBACjE;gBACJ,EAAE,OAAO,GAAG;oBACR,QAAQ,KAAK,CAAC,kCAAkC;gBACpD;YACJ;QACJ;IACJ,CAAC,GACD;IACI,MAAM;IACN,SAAS,IAAA,2LAAiB,EAAC,IAAM;AACrC"}}]
}